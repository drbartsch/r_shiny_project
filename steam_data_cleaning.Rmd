---
title: "steam_data_cleaning"
author: "Dennis Bartsch"
date: "5/25/2021"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

This is the beginning of the R Shiny Project. Here, I begin by setting up my environment by importing the `tidyverse` library, as it has many of the packages I will need, including `ggplot2`, `dplyr`, and more.

```{r}
library(tidyverse)
```

The dataset I am using is a collection of games hosted on the Steam video game digital distribution service. This dataset was originally gathered in May of 2019. In this file, I am going to outline my process of cleaning the data. I will being by reading in the dataset, which is contained in a csv file.

```{r}
steam <- read_csv("./steam.csv")
```

The first step is to review the structure of the data frame, including looking at the classes of each field in the data frame to see if they are appropriate for the given variable. Among other things, it's shown that the observations in the `release_date` field are all character strings instead of dates. We also see that there are 27,075 observations in total.

```{r}
str(steam)
```

```{r}
sapply(steam, class)
```

Convert the release_date observations from character strings to dates using the `lubridate` package.

```{r}
library(lubridate)
```

```{r}
steam$release_date <- mdy(steam$release_date)
```

```{r}
class(steam$release_date)
```

Next, I want to check if every `appid` in the `appid` field is unique by counting the total number of rows and the number of distinct IDs in the dataset.

```{r}
steam %>% 
  summarize(appid_count = nrow(.), distinct_appid_count = n_distinct(appid))
```

Given that there are 27,075 rows in the data frame and 27,075 distinct IDs, it is safe to say that each of them are unique.

Notice how the `platforms` field has multiple values separated by semicolons for many observations, such as `windows`, `mac`, and even `linux` in some instances. This field should be split into as many distinct fields as there are values separated by the semicolon. First, let's check to see what the unique values are in this column.

```{r}
unique(steam$platforms)
```

This reveals that there are seven combinations of platforms in this column, but that there are only three distinct platforms (windows, mac, and linux). The next step is to split the `platforms` field into three, one for each distinct platform.

The method I used to do this was to create a new data frame using the steam data frame. In it, the platforms variable contains observations with multiple delimited values, so I used the `separate_rows` function to separate the values and place each on its own row. I then selected the `appid`, `name`, and `platforms` columns so I could eventually check the results and joing the resulting data frame with the original. I had to add a column with a value denoting that the particular game is supported on that platform (with the value of 1). Finally, I used the `spread` function to spread the `platforms` column over multiple based on the unique values in it ("windows", "mac", and "linux"). This required the use of the `is_on_platform` column for the new columns to hold their respective values.

```{r}
steam_platforms <- steam %>% 
  separate_rows(platforms) %>% 
  select(appid, name, release_date, platforms)
```

This is the result:

```{r}
steam_platforms
```
 
As I did earlier, I am going to split another column in the dataset called `categories`, as many observations contain multiple values that could each be considered their own distinct variables (e.g. multi-player, Valve Anti-Cheat enabled, etc.).

```{r}
steam_categories <- steam %>% 
  separate_rows(categories, sep = ";") %>% 
  select(appid, categories) %>% 
  mutate(is_in_category = 1) %>% 
  spread(categories, is_in_category)
```

This is the result:

```{r}
steam_categories
```

Next, I will join the `steam_categories` data frame to the existing `steam` data frame so that these new columns are included.

```{r}
steam <- steam %>% 
  inner_join(steam_categories, by = "appid")
```

As I did earlier with `platforms` and `categories`, I am going to split another column in the dataset called `genres`, as many observations contain multiple values that could each be considered their own distinct variables (e.g. action, indie, strategy, etc.).

```{r}
steam_genres <- steam %>% 
  separate_rows(genres, sep = ";") %>% 
  select(appid, genres) %>% 
  mutate(has_genre = 1) %>% 
  spread(genres, has_genre)
```

This is the result:

```{r}
steam_genres
```

Next, I will join the `steam_genres` data frame to the existing `steam` data frame so that these new columns are included.

```{r}
steam <- steam %>% 
  inner_join(steam_genres, by = "appid")
```

As I did earlier with `platforms`, `categories`, and `genres` I am going to split another column in the dataset called `steamspytags`, as many observations contain multiple values that could each be considered their own distinct variables (e.g. action, indie, strategy, etc.). Some of these tags include data that will be repeated, such as `Action` for the first game in the dataset. However, there are some useful tags that have not been included in the genres that are in the `steamspytags` observations, such as FPS (first-person-shooter).

```{r}
steamspy_tags <- steam %>% 
  separate_rows(steamspy_tags, sep = ";") %>% 
  select(appid, steamspy_tags) %>% 
  mutate(has_tag = 1) %>% 
  spread(steamspy_tags, has_tag)
```

This is the result:

```{r}
steamspy_tags
```

For now, I am going to keep the `steamspy_tags` data frame separate from the `steam` one, as there are 341 variables in `steamspy_tags`, many of which are not relevant. I can join the tables if I'm curious about something specific later on.